package xml

import (
	"strings"
	"testing"

	"github.com/stretchr/testify/assert"
)

var testXML = `<body><p>Oil explorers... <ft-concept type="http://www.ft.com/ontology/company/PublicCompany" url="http://api.ft.com/organisations/ed15d0ee-7e98-399e-9b4b-e6a55beeb56a">Soco International</ft-concept> and <ft-concept type="http://www.ft.com/ontology/company/PublicCompany" url="http://api.ft.com/organisations/37eab17b-f976-3c2e-889a-763968002cba">Cairn Energy</ft-concept> have been reported to UK regulators for allegedly failing to tell investors enough about the risks that climate change poses to their businesses.</p> <p>Soco and Cairn deny the claims.</p> <p>The complaint from ClientEarth environmental law firm in London is the latest in a string of legal challenges to fossil fuel companies from campaigners seeking faster action on global warming.</p> <p>The firm has written to the <a href="https://www.frc.org.uk/Home.aspx" title="www.frc.org.uk">Financial Reporting Council</a>, the accounting and auditing watchdog, arguing climate change poses “significant” physical and financial threats to oil and gas companies that amount to a material risk.</p> <p>This should be disclosed to investors under UK companies’ law provisions that required businesses to describe “the principal risk and uncertainties” they faced, ClientEarth said.</p> <p>London-listed Soco and Cairn did not do this sufficiently in their most recent annual reports and accounts, the firm alleged.</p> <p>“Failing to adequately disclose climate risks is failing to mention one of the most important risks facing the company,” said Alice Garton, the ClientEarth lawyer handling the case.</p> <p>Soco strongly rebuffed ClientEarth’s claims and said it was confident the group had met its legal obligations. However, the group said it took allegations of non-compliance seriously and was reviewing the law firm’s complaint.</p> <p>While climate change was a key consideration for the company, Soco told the FT its board had decided that, “in keeping with its sector peers”, it would not include climate change as “a separate risk among the principal risks to the company’s strategy in 2015”.</p> <p>The company said the principal risks listed in its annual report include uncertainties and trends potentially associated with climate change, as identified by ClientEarth, including environmental impacts, commodity prices and operating costs.</p> <p>Soco added it will continue to identify the key areas of risk and uncertainties to the group’s business, including a continued assessment of the potential impact of climate change.</p> <p>Cairn said it was a constituent of the FTSE4Good index designed to identify companies with recognised corporate responsibility practices and took its commitments to responsible and transparent reporting “very seriously”.</p> <p>“We continually identify corporate responsibility priorities and our 2015 annual report featured climate change in the comprehensive materiality matrix,” Cairn said.</p> <p>The matrix is a diagram showing the importance of various issues to Cairn and its stakeholders, including succession planning, biodiversity and accident prevention.</p> <p>Both Cairn and Soco’s annual reports disclose greenhouse gas emissions from their own activities, as required under UK law.</p> <p>Cairn noted the UN <a href="http://unfccc.int/files/essential_background/convention/application/pdf/english_paris_agreement.pdf">climate accord</a>, which nearly every country agreed in Paris in December, said net emissions should fall to zero some time between 2050 and 2100 and governments should keep global warming “well below 2C” from pre-industrial levels, while trying for a safer 1.5C.</p> <p>Cairn, which operates in Senegal, the UK and other countries, said it expected emissions management “will become increasingly important to any future production”.</p> <p>The report by Soco, which is active in Vietnam, Angola and the Republic of Congo, mentioned the climate risk information it volunteered to the <a href="https://www.cdp.net/en-US/Pages/About-Us.aspx" title="www.cdp.net">Carbon Disclosure Project</a>, a non-government organisation. It has said the magnitude of the impact of threats such as energy taxes and hurricanes is unknown.</p> <p>ClientEarth said physical climate threats could disrupt companies’ operations on the ground.</p> <p>Separately, the law firm pointed to bank research on the financial risks fossil fuel companies face from carbon taxes, electric car subsidies and other policies aimed at cutting greenhouse gases and promoting greener energy alternatives.</p> <p><a href="http://climateobserver.org/wp-content/uploads/2015/09/Energy-Darwinism-Citi-GPS.pdf">Citibank said</a> last year the switch to a low-carbon world could lead to “unburnable” fossil fuel reserves with a value amounting to more than $100tn by 2050.<a href="http://www.longfinance.net/images/reports/pdf/Barclays_Climate_Change_Warming_up_for_COP-21_2015.pdf"> Barclays estimated</a> that oil industry revenues could be cut by $22tn between 2014 and 2040.</p> <p>“These are obviously very serious predictions for the oil and gas industry and those who invest in it,” said ClientEarth.</p> <p>The firm said climate risks were spelt out in the reports of other London-listed oil companies, such as <ft-concept type="http://www.ft.com/ontology/company/PublicCompany" url="http://api.ft.com/organisations/900a2014-cfc0-3b49-9ede-7dcf8594d337">Tullow Oil</ft-concept> and <ft-concept type="http://www.ft.com/ontology/company/PublicCompany" url="http://api.ft.com/organisations/e191b2c4-4e79-3fb7-b454-2270610ea352">Royal Dutch Shell.</ft-concept> </p> <p>Tullow’s latest <a href="http://www.tullowoil.com/Media/docs/default-source/3_investors/2015-annual-report/tullow-oil-2015-annual-report-and-accounts.pdf" title="www.tullowoil.com">annual report </a>acknowledged suggestions that, as governments adopted stricter climate policies, “the majority of coal, oil and gas deposits will remain undeveloped”. </p> <p>“Tullow recognises the potential risks in light of this issue,” the report said, adding the group still believed the oil and gas industry will have a role “for decades to come”.</p> <p>The FRC said it would look at ClientEarth’s suggestions and “see what if any next steps need to be taken”.</p> </body>`
var expected = `Oil explorers Soco International and Cairn Energy have been reported to UK regulators for allegedly failing to tell investors enough about the risks that climate change poses to their businesses. Soco and Cairn deny the claims. The complaint from ClientEarth environmental law firm in London is the latest in a string of legal challenges to fossil fuel companies from campaigners seeking faster action on global warming. The firm has written to the Financial Reporting Council, the accounting and auditing watchdog, arguing climate change poses “significant” physical and financial threats to oil and gas companies that amount to a material risk. This should be disclosed to investors under UK companies’ law provisions that required businesses to describe “the principal risk and uncertainties” they faced, ClientEarth said. London-listed Soco and Cairn did not do this sufficiently in their most recent annual reports and accounts, the firm alleged. “Failing to adequately disclose climate risks is failing to mention one of the most important risks facing the company,” said Alice Garton, the ClientEarth lawyer handling the case. Soco strongly rebuffed ClientEarth’s claims and said it was confident the group had met its legal obligations. However, the group said it took allegations of non-compliance seriously and was reviewing the law firm’s complaint. While climate change was a key consideration for the company, Soco told the FT its board had decided that, “in keeping with its sector peers”, it would not include climate change as “a separate risk among the principal risks to the company’s strategy in 2015”. The company said the principal risks listed in its annual report include uncertainties and trends potentially associated with climate change, as identified by ClientEarth, including environmental impacts, commodity prices and operating costs. Soco added it will continue to identify the key areas of risk and uncertainties to the group’s business, including a continued assessment of the potential impact of climate change. Cairn said it was a constituent of the FTSE4Good index designed to identify companies with recognised corporate responsibility practices and took its commitments to responsible and transparent reporting “very seriously”. “We continually identify corporate responsibility priorities and our 2015 annual report featured climate change in the comprehensive materiality matrix,” Cairn said. The matrix is a diagram showing the importance of various issues to Cairn and its stakeholders, including succession planning, biodiversity and accident prevention. Both Cairn and Soco’s annual reports disclose greenhouse gas emissions from their own activities, as required under UK law. Cairn noted the UN climate accord, which nearly every country agreed in Paris in December, said net emissions should fall to zero some time between 2050 and 2100 and governments should keep global warming “well below 2C” from pre-industrial levels, while trying for a safer 1.5C. Cairn, which operates in Senegal, the UK and other countries, said it expected emissions management “will become increasingly important to any future production”. The report by Soco, which is active in Vietnam, Angola and the Republic of Congo, mentioned the climate risk information it volunteered to the Carbon Disclosure Project, a non-government organisation. It has said the magnitude of the impact of threats such as energy taxes and hurricanes is unknown. ClientEarth said physical climate threats could disrupt companies’ operations on the ground. Separately, the law firm pointed to bank research on the financial risks fossil fuel companies face from carbon taxes, electric car subsidies and other policies aimed at cutting greenhouse gases and promoting greener energy alternatives. Citibank said last year the switch to a low-carbon world could lead to “unburnable” fossil fuel reserves with a value amounting to more than $100tn by 2050. Barclays estimated that oil industry revenues could be cut by $22tn between 2014 and 2040. “These are obviously very serious predictions for the oil and gas industry and those who invest in it,” said ClientEarth. The firm said climate risks were spelt out in the reports of other London-listed oil companies, such as Tullow Oil and Royal Dutch Shell. . Tullow’s latest annual report acknowledged suggestions that, as governments adopted stricter climate policies, “the majority of coal, oil and gas deposits will remain undeveloped”. . “Tullow recognises the potential risks in light of this issue,” the report said, adding the group still believed the oil and gas industry will have a role “for decades to come”. The FRC said it would look at ClientEarth’s suggestions and “see what if any next steps need to be taken”. `

var testXML2 = `<body> <p>The day I moved to London, I set fire to my bedroom. Before my arrival, the room had been a humble cupboard. I had no bed or chair, but a good stock of tea lights, which — feeling homesick — I lit. Presently, the tea lights lit a pile of paper and then the carpet . . . I was 22 and moving to London felt like a mistake.</p> <p>Fourteen years on, I tend to tell everyone I love London. I don’t love all of it — just the few places I go to all the time, like the curiously chic butcher, which is also a restaurant. In my perfect world, I’d eat there all the time; I am an habitué; I’ve even been there on my own. </p> <p>Such places — I have similar feelings for <ft-content type="http://www.ft.com/ontology/content/Article" url="http://test.api.ft.com/content/e6bd67ce-8ed6-11e6-a72e-b428cb934b78">my hairdresser</ft-content> and a pub nearby full of arty-looking dogs and taxidermy — make me feel local. And that’s good.</p> <p>But not always good, apparently. My wife thinks we should try places beyond east London; she wants to go to a famous restaurant. And she picks one — 24 tiny dishes with avant-garde names. </p> <p>On the big night, I select a blue shirt and blue trousers — understated. My wife, dressed — casually — to the nines, curls the fringe of her shiny blonde bob. </p> <p>Her restaurant smells of wood smoke. Waiters skim about. The lights are dim — squint and we could be dining in a friendly forest in Finland. We order the second cheapest bottle of white. And so the show begins.</p> <p>Enter a warm ball of bread with a scoop of aniseed butter. “Mmm,” I say. “Mmm. Aniseed butter.” </p> <p>Two bites in, my wife queries the whole concept of aniseed butter.</p> <p>Enter a mushroom tart, unbearably light: “Mmm,” I say, as the morsel evaporates on my tongue. “Wow. Subtle.”</p> <p>“It’s tasteless,” my wife says.</p> <p>Further dishes make fleeting appearances — something with truffle gel, something soft and something fishy — and then a menu arrives on thick paper, our own special menu because every table is unique. “Mielikki essence and strawberries,” I read. “Where are the meat dishes?”</p> <p>Enter a cold crab claw.</p> <p>“It’s frozen,” my wife observes.</p> <p>It’s crab ice-cream, judging by our menu. We try it. “Mmm. That’s . . . ”</p> <p>“Gross,” she says. But there’s no need to panic, there’s plenty still to go. The wine is going down well, at least, and we’ll order red with the meat. I have my heart set on slivers of duck, or a tiny pink cutlet, or beef. But perhaps this is a fish restaurant.</p> <p>One clam appears, swimming in white foam. “Mmm,” I say, dispatching the mollusc in a trice, and set off questing for the loo.</p> <p>In the mirror, my shirt appears to be clashing with my trousers — different blues. My beard — in its shy early phase — conveys an air of mild dirtiness. It is intended to give me gravitas, but perhaps it makes me look defeated. And homeless.</p> <p>Back at the table, my wife notes that we are more than halfway through. </p> <p>An oyster cased in lemon peel. No duck. Cheese wrapped in cloth. A rubbery thing. Not a sliver of duck in sight. And something else — no one knows what. “What’s this?” I ask.</p> <p>“I feel swizzed,” my wife says sadly.</p> <p>A waiter sneaks up, wondering if we’re happy. Couldn’t be happier. He smiles, as if he is also happy and we his favourite table — but then maybe it’s just his training and maybe . . . I feel like a giant slob next to him.</p> <p>Pudding. Hopes of meat completely dashed, I order a bottle of red anyway — pushing us over budget — and banter about Donald Trump. My wife is visibly depressed. Wolfing into the wine, she denounces the food dish by dish.</p> <p>And then we have a strawberry — an ex-strawberry, that is — and the strawberry is the final straw: it resembles a sweet, cold human tongue. </p> <p>“We’ve been given the bad menu,” she says. “Why can’t we have what they’re having? I’m going to complain.”</p> <p>But she can’t because we’re suddenly given a tour of the kitchen, where all the magic happens, and we stand about staring at the chefs and nodding sagely. If we can’t pay the bill, we’ll be doing the washing up in here.</p> <p>Leaving, my wife accidentally hoofs a small, superfluous stool beside her chair, stumbles and cries out in pain. Two waiters police the situation. “It’s nothing,” I say.</p> <p>In the taxi, we pass my butcher. It is late, but my fellow habitués are still eating meat merrily. Warm light spills on to the pavement and — like Mole smelling his home — I would like to peek inside. </p> <p><em>Alexander Gilmour is associate editor of House &amp; Home; <a href="https://twitter.com/aimgilmour">@AIMGilmour</a> </em> </p> <p><em>Next week: Jane Owen’s ‘Provincial life’</em> </p> <p><em>Illustration: Sarah Hanson</em> </p> </body>`

func TestParseBodyXml(t *testing.T) {
	content, err := ParseBodyXML(strings.NewReader(testXML))
	if err != nil {
		t.Fatal(err)
	}

	assert.Equal(t, expected, content, "Content not right!")
}

func TestParseBodyXml2(t *testing.T) {
	content, err := ParseBodyXML(strings.NewReader(testXML2))
	if err != nil {
		t.Fatal(err)
	}

	t.Log(content)
}
